{# build the sections class string #}
{% set sectionClasses = "section-wrapper" %}

{# add user defined section class(es) #}
{% if section.containerFields.containerClass %}
  {% set sectionClasses = sectionClasses ~ " " ~ section.containerFields.containerClass %}
{% endif %}

{% if section.containerFields.inContainer %}
  {% set sectionClasses = sectionClasses ~ " inContainer" %}
{% endif %}

{% if section.containerFields.isNarrow %}
  {% set sectionClasses = sectionClasses ~ " isNarrow" %}
{% endif %}

{% if section.containerFields.isDisabled %}
  {% set sectionClasses = sectionClasses ~ " isDisabled" %}
{% endif %}

{% if section.containerFields.isAnimated %}
  {% set sectionClasses = sectionClasses ~ " isAnimated" %}
{% endif %}

{% if section.containerFields.background.isDark %}
  {% set sectionClasses = sectionClasses ~ " isDark" %}
{% endif %}

{# get the sections id string #}
{% set sectionId = "" %}
{% if section.containerFields.containerId %}
  {% set sectionId = section.containerFields.containerId %}
{% endif %}

{# build the section inline styles string #}
{% set sectionStyles = "" %}
{% if section.containerFields.background.color %}
  {% set sectionStyles = sectionStyles ~ "background-color:" ~ section.containerFields.background.color ~ ";" %}
{% endif %}
{% if section.containerFields.background.image %}
  {% set sectionStyles = sectionStyles ~ "background-image: url(" ~ section.containerFields.background.image ~ ");" %}
{% endif %}

<{{section.container}} 
  class="{{ sectionClasses }}" 
  {% if sectionId %} id="{{ sectionId }}" {% endif %} 
  {% if sectionStyles %} style="{{ sectionStyles }}" {% endif %}
>

  <script>
    function isStylesheetLoaded(url) {
      return Array.from(document.styleSheets).some(styleSheet => {
        if (styleSheet.href) {
          return styleSheet.href === url;
        }
        return false;
      });
    }

    function loadStylesheet(url, integrity, crossOrigin) {
      if (!isStylesheetLoaded(url)) {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = url;
        link.integrity = integrity;
        link.crossOrigin = crossOrigin;
        document.head.appendChild(link);
      } else {
        console.log('Stylesheet is already loaded.');
      }
    }

    function loadLeafletScript() {
      return new Promise((resolve, reject) => {
          if (typeof L !== 'undefined') {
              resolve();
              return;
          }

          var script = document.createElement('script');
          script.type = 'text/javascript';
          script.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
          script.integrity = 'sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=';
          script.crossOrigin = '';

          script.onload = function() {
              resolve();
          };

          script.onerror = function() {
              reject(new Error('Failed to load the Leaflet script.'));
          };

          document.head.appendChild(script);
      });
  }
  </script>

  <style>
    #{{ section.leaflet.containerId }} {
      height: {{ section.leaflet.containerHeight }}px;
      width: 100%;
    }
  </style>

  <div class="image-wrapper section-inner">
    <div class="map-wrapper isLeafLet section-inner">
      <div id={{ section.leaflet.containerId }}></div>
    </div>
  </div>

  <script>
    loadStylesheet('https://unpkg.com/leaflet@1.9.4/dist/leaflet.css', 'sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=', '');

    loadLeafletScript().then(() => {
      const mapOptions = {
        center: [{{ section.leaflet.centerX }}, {{ section.leaflet.centerY }}],
        zoom: {{ section.leaflet.zoom }},
      };

      const map = new L.map("{{ section.leaflet.containerId }}", mapOptions);

      const layer = new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png");

      map.addLayer(layer);

    }).catch(error => {
        console.error(error);
    });
  </script>
</{{section.container}}>